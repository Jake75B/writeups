
### Lab 1-1

This lab uses the files `Lab01-01.exe` and `Lab01-01.dll`. Use the tools and techniques described in the chapter to gain information about the files and answer the questions below.

1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures? 

By uploading both executables to virusTotal, we get these results:

Lab01-01.dll: 39/72 detected
Lab01-01.exe: 57/72 detected

This concludes that both executables show signs of malware signatures.

![](../PMA%20attatchments/Chapter%202%20-%20labs-06.11.25-paste.png)

![](../PMA%20attatchments/Chapter%202%20-%20labs-06.11.25-paste-1.png)

---

2.  **When were these files compiled?** 

Using CFF Explorer, we can view`lab01-01.exe`'s compile time in its file header. This value is stored under `TimeDateStamp`as **4D0E2FD3**.

![](../PMA%20attatchments/Solutions-18.10.25-paste-4.png)
 
 By converting this value to decimal we get **1292775379** and. This value is a unix epoch timestamp and when translating to a real timestamp we get this date:
 
![](../PMA%20attatchments/Solutions-18.10.25-paste-20.png)

The same can be done for`Lab01-01.dll` 

![](../PMA%20attatchments/Solutions-18.10.25-paste-3.png)

-  `Lab01-01.exe`compile date: Sunday, 19 December 2010, 16:16:19
- `Lab01-01.dll`compile date: Sunday,  19 December 2010, 16:16:38

---

3.  Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?

By directing our attention to the EP Section of `Lab01-01.dll`  in the image below, we can see it contains `.text`.  If it was packed, it would be empty/show unknown or it would show the packer for example `UPX1`or `.rsrc`. Additionally it is compiled using Visual C++ 6.0 which shows the binary structure hasn't been changed and therefore unpacked.

![](../PMA%20attatchments/Chapter%202%20-%20labs-01.11.25-paste.png)

`Lab-01.exe` shows the same result.

![](../PMA%20attatchments/Chapter%202%20-%20labs-01.11.25-paste%201.png)

By checking the difference in virtual size and raw size, we can see they are as follows:

Virtual size: 0x0000039E = 926 bytes
Raw size: 0x00001000 = 4096 bytes

Small differences are normal, and are due to differences between alignment in memory and on disk so this isn't a sign of packing. Therefore we can conclude that there is no packing or obsufication

![](../PMA%20attatchments/Chapter%202%20-%20labs-06.11.25-paste-2.png)

---

4. Do any imports hint at what this malware does? If so, which imports are they? 

We can see that 3 `.dll`'s are imported. We can use **Dependency walker** to take a look at the functions in the `.dll`'s

![](../PMA%20attatchments/Chapter%202%20-%20labs-06.11.25-paste-3.png)


`Kernal32.dll`: Very common DLL for core functionality, such as access and manipulation of memory, files and hardware

**List of imports:**

- `CreateMutexA: `Creates a mutual exclusion object that can be used by malware to ensure that only a single instance of the malware is running on a system at any given time. Malware often uses fixed names for mutexes, which can be good host-based indicators to detect additional installations of the malware.

- `CreateProcessA`: Creates a new process

- `OpenMutexA`: Opens a handle to a mutual exclusion object that can be used by malware to ensure that only a single instance of malware is running on a system at any given time. Malware often uses fixed names for mutexes, which can be good host-based indicators.

- `Sleep`: Sleeps a process

![](../PMA%20attatchments/Chapter%202%20-%20labs-06.11.25-paste-4.png)


`WS2_32.dll`: Networking DLL for connecting to a network / network related tasks

**List of imports:**

![](../PMA%20attatchments/Chapter%202%20-%20labs-07.11.25-paste.png)

`MSVCRT.dll:` provides programs compiled by these versions of MSVC with most of the standard C library function

**List of imports:**

![](../PMA%20attatchments/Chapter%202%20-%20labs-07.11.25-paste-1.png)

Based on these imports can infer that the dll would likely spawn a new process and sleep (pause execution) at some point in it's execution.


Now we can take a look at `Lab01-01.exe`:

`Kernel32.dll`: Very common DLL for core functionality, such as access and manipulation of memory, files and hardware

**List of imports:**

- `CloseHandle`: Closes an open object handle (file, event, mutex, thread, process, file-mapping, etc.) and releases the associated system resources.

- `CopyFileA`: Copies an existing file.

- `CreateFileA`: Creates a new file or opens an existing file.

- `CreateFileMappingA`: Creates a handle to a file mapping that loads a file into memory and makes it accessible via memory addresses. Launchers, loaders, and injectors use this function to read and modify PE files

- `FindClose`: Closes a search handle returned by FindFirstFile and frees resources used for directory enumeration.

- `FindFirstFileA`: Used to search through a directory and enumerate the filesystem.

- `FinddNextFileA`: Used to search through a directory and enumerate the filesystem.

- `IsBadReadPtr`: Attempts to verify whether a pointer points to readable memory.

- `MapViewOfFile`: Maps a file into memory and makes the contents of the file accessible via memory addresses. Launchers, loaders, and injectors use this function to read and modify PE files. By using MapViewOfFile, the malware can avoid using WriteFile to modify the contents of a file.

- `UnmapViewOfFile`: Unmaps a mapped view previously returned by MapViewOfFile, releasing the mapped address range.


When we look at the imports from, we see functions for opening and changing files, as well as the functions `FindFirstFile` and` FindNextFile`. These functions tell us that the malware searches through the filesystem, and that it can open and modify files.

![](../PMA%20attatchments/Chapter%202%20-%20labs-07.11.25-paste-2.png)

By taking a look at the `.data` section in the hex editor, we can see there is an Ascii string that shows the filepath to`kerne132.dll`. The letter change from 'L' to '1' tells us that `kerne132.dll` is attempting to disguise itself as the Windows kernel32.dll file.


---

5.  Are there any other files or host-based indicators that you could look for on infected systems?

By taking a look at the `.data` section in the hex editor, we can see there is an Ascii string that shows the filepath to`kerne132.dll`. The letter change from 'L' to '1' tells us that `kerne132.dll` is attempting to disguise itself as the Windows kernel32.dll file. This can act has a suitable IOC/host based indicator.

![](../PMA%20attatchments/Chapter%202%20-%20labs-07.11.25-paste-3.png)

---

6.  What network-based indicators could be used to find this malware on infected machines?

Taking a look at the `.data` in Lab01-01.dll , we can deduce that this IP address is contacted during the malware's execution. 

![](../PMA%20attatchments/Chapter%202%20-%20labs-07.11.25-paste-4.png)

---

7. What would you guess is the purpose of these files?

The purpose of this malware is likely a trojan / backdoor. It likely uses`Lab01-01.exe` to install `lab01-01.dll` which places the disguised `kerna132.dll` in the victims **system32** folder. It then contacts an IP which could allow remote access.


---

### Lab 1-2

1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

Lab01-01.exe: 58/72 detected

Yes, it matches 58/72 Virus signitures

![](../PMA%20attatchments/Chapter%202%20-%20labs-08.11.25-paste.png)


2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

By taking a look at the EP Section, we can see that it's`.UPX1` and not `.text`. This is an indication of packing/obfuscation.  Additionally, the compiler signiture shows `UPX -> www.upx.sourceforge.net` which is another indicator.

![](../PMA%20attatchments/Chapter%202%20-%20labs-08.11.25-paste-1.png)

By looking in **CFFexplorer**, we can see the raw size and virtual size.


UPX0: 16384 bytes, 0 bytes
UPX1: 4096 bytes, 1536 bytes
UPX2: 4096 bytes,  512 bytes

| Section | Virtual Size | Raw Size | Observation                | Packed Indicator |
|----------|---------------|----------|-----------------------------|------------------|
| UPX0     | 16384 bytes   | 0 bytes   | Empty or fully compressed   | ✅ Yes           |
| UPX1     | 4096 bytes    | 1536 bytes | Raw < Virtual (compressed)  | ✅ Yes           |
| UPX2     | 4096 bytes    | 512 bytes  | Raw < Virtual (compressed)  | ✅ Yes           |





![](../PMA%20attatchments/Chapter%202%20-%20labs-08.11.25-paste-2.png)

3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?

4. What host-or network-based indicators could be used to identify this malware on infected machines?

